version: "0.1.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_pointer: []
  requester:
    type: HttpRequester
    url_base: "https://kf.kobotoolbox.org/api/v2/assets"
    http_method: "GET"
    authenticator:
      type: BasicHttpAuthenticator
      username: "{{ config['username'] }}"
      password: "{{ config['password'] }}"
  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: NoPagination
    requester:
      $ref: "*ref(definitions.requester)"
  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "*ref(definitions.retriever)"
  forms_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "forms"
      primary_key: "_id"
      path: "/{{ config['uid'] }}/data.json"

streams:
  - "*ref(definitions.forms_stream)"

check:
  stream_names:
    - "forms"

spec:
  documentation_url: https://docs.airbyte.com/integrations/sources/kobotoolbox
  connection_specification:
    title: Kobotoolbox Spec
    type: object
    required:
      - username
      - password
      - uid
    additionalProperties: true
    properties:
      username:
        type: string
        title: Username
        description: Username to authenticate into the KoboToolbox server
        order: 1
      password:
        type: string
        title: Password
        description: Password to authenticate into the KoboToolbox server
        airbyte_secret: true
        order: 2
      uid: 
        type: string
        title: UID
        description: UID to pull data from
        order: 3